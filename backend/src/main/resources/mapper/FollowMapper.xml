<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.edu.example.backend.mapper.FollowMapper">
  
  <!-- 判断是否已关注 -->
  <select id="isFollowing" resultType="int">
    SELECT COUNT(*) 
    FROM follow 
    WHERE follower_id = #{followerId} AND following_id = #{followingId}
  </select>
  
  <!-- 获取用户粉丝数量 -->
  <select id="getFollowersCount" resultType="int">
    SELECT COUNT(*) 
    FROM follow 
    WHERE following_id = #{userId}
  </select>
  
  <!-- 获取用户关注数量 -->
  <select id="getFollowingCount" resultType="int">
    SELECT COUNT(*) 
    FROM follow 
    WHERE follower_id = #{userId}
  </select>
  
  <!-- 获取用户关注的人的ID列表 -->
  <select id="getFollowingUserIds" resultType="java.lang.Long">
    SELECT following_id
    FROM follow
    WHERE follower_id = #{userId}
    ORDER BY created_at DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>
  
  <!-- 获取用户粉丝的ID列表 -->
  <select id="getFollowerUserIds" resultType="java.lang.Long">
    SELECT follower_id
    FROM follow
    WHERE following_id = #{userId}
    ORDER BY created_at DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>
  
  <!-- 关注用户 -->
  <insert id="insert" parameterType="com.edu.example.backend.entity.Follow">
    INSERT INTO follow (follower_id, following_id, created_at)
    VALUES (#{followerId}, #{followingId}, #{createdAt})
  </insert>
  
  <!-- 取消关注 -->
  <delete id="delete" parameterType="map">
    DELETE FROM follow 
    WHERE follower_id = #{followerId} AND following_id = #{followingId}
  </delete>
  
</mapper>