# Campus Hub 运行指南

## 前置要求

1. **Java 17+** - 后端需要
2. **Node.js 20.19.0+ 或 22.12.0+** - 前端需要
3. **MySQL 5.7+** - 数据库
4. **Maven** - 后端构建工具

## 第一步：数据库初始化

### 1. 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS campus_hub CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. 执行初始化脚本

按顺序执行以下SQL文件（在MySQL客户端或工具中执行）：

```bash
# 1. 基础表结构
backend/sql/init.sql

# 2. 初始化帖子数据（可选）
backend/sql/post_init.sql

# 3. 初始化评论数据（可选）
backend/sql/comment_init.sql

# 4. 丰富话题内容（推荐执行）
backend/sql/enriched_topics.sql

# 5. 校园评论数据（推荐执行）
backend/sql/campus_comments.sql
```

### 3. 检查数据库配置

确认 `backend/src/main/resources/application.yml` 中的数据库配置：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/campus_hub?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
    username: root        # 修改为你的MySQL用户名
    password: 123456      # 修改为你的MySQL密码
```

## 第二步：启动后端服务

### 方式一：使用IDE（推荐）

1. 使用 IntelliJ IDEA 或 Eclipse 打开 `backend` 目录
2. 等待Maven依赖下载完成
3. 运行 `BackendApplication.java` 的 `main` 方法

### 方式二：使用Maven命令

```bash
# 进入后端目录
cd backend

# 编译并运行
mvn spring-boot:run

# 或者先打包再运行
mvn clean package
java -jar target/backend-0.0.1-SNAPSHOT.jar
```

### 方式三：使用Maven Wrapper（Windows）

```bash
cd backend
.\mvnw.cmd spring-boot:run
```

### 验证后端启动

后端启动成功后，访问以下地址验证：

- 后端服务：http://localhost:8082
- API测试：http://localhost:8082/api/posts?pageNum=1&pageSize=10

## 第三步：启动前端服务

### 1. 安装依赖

```bash
# 进入前端目录
cd frontend

# 安装npm依赖
npm install
```

**注意**：如果安装失败，可以尝试：
```bash
npm install --legacy-peer-deps
```

### 2. 启动开发服务器

```bash
npm run dev
```

### 3. 访问前端

前端启动后，控制台会显示访问地址，通常是：
- http://localhost:5173 （Vite默认端口）

**重要**：前端已配置代理，会自动将 `/api` 请求转发到后端 `http://localhost:8082`，确保后端先启动。

## 第四步：验证运行

### 1. 检查后端API

打开浏览器访问：
```
http://localhost:8082/api/posts?pageNum=1&pageSize=10
```

应该返回JSON格式的帖子列表数据。

### 2. 检查前端页面

打开浏览器访问：
```
http://localhost:5173
```

应该能看到前端界面。

### 3. 测试功能

- 查看文章列表
- 查看问答列表
- 查看文章/问答详情
- 查看评论功能

## 常见问题

### 1. 后端启动失败

**问题：数据库连接失败**
- 检查MySQL服务是否启动
- 检查 `application.yml` 中的数据库配置是否正确
- 确认数据库 `campus_hub` 已创建

**问题：端口被占用**
- 修改 `application.yml` 中的 `server.port` 为其他端口（如8083）

### 2. 前端启动失败

**问题：端口被占用**
- Vite会自动尝试其他端口，查看控制台输出

**问题：依赖安装失败**
- 删除 `node_modules` 和 `package-lock.json`，重新执行 `npm install`
- 或使用 `npm install --legacy-peer-deps`

### 3. 前端无法连接后端

- 确保后端服务已启动（http://localhost:8082）
- 检查 `frontend/vite.config.js` 中的代理配置：
  ```js
  proxy: {
    '/api': {
      target: 'http://localhost:8082', // 确保端口正确
      changeOrigin: true,
    }
  }
  ```
- 如果后端端口不是8082，需要修改 `vite.config.js` 中的 `target` 配置

## 开发模式

### 后端热重载

使用IDE的自动编译功能，或使用Spring Boot DevTools。

### 前端热重载

Vite默认支持热重载，修改代码后会自动刷新。

## 生产环境部署

### 后端打包

```bash
cd backend
mvn clean package
# 生成的jar文件在 target/backend-0.0.1-SNAPSHOT.jar
```

### 前端打包

```bash
cd frontend
npm run build
# 生成的文件在 dist/ 目录
```

## 默认账号

根据 `init.sql`，默认管理员账号：
- 用户名：`admin`
- 密码：`123456`

